# 김장 작물 질병 분류 모델 프로젝트
**2024 DSWU 소프트웨어 전공 강의 [딥러닝플랫폼실습] 기말 과제 리포지토리입니다.**

</br>

<details>
<summary>목차</summary>

- [1. 프로젝트 개요](#프로젝트-개요)
- [2. 데이터셋 전처리](#데이터셋-전처리)
- [3. CNN 모델 구축 및 학습](#cnn-모델-구축-및-학습)
    - [CNN](#cnn)
    - [ResNet](#resnet)
- [4. MTL 모델 구축 및 학습](#mtl-모델-구축-및-학습)
    - [기본 모델](#기본-모델)
    - [가중치 비율 적용](#가중치-비율-적용)
- [5. 모델 성능 비교](#모델-성능-비교)
    - [손실함수 적용 비율](#손실함수-적용-비율)
    - [가중치 비율 적용 여부](#가중치-비율-적용-여부)
    - [하이퍼 파라미터 비교](#하이퍼파라미터-비교)
- [6. 최종 모델 비교](#최종-모델-비교교)
- [7. 프로젝트 주의사항 및 코드 사용 설명](#프로젝트-주의사항-및-코드-사용-설명)
    - [프로젝트 환경](#프로젝트-환경)
    - [주의사항](#주의사항)
    - [코드 사용 설명](#코드-사용-설명)
- [Reference](#reference)

</details>


<br/><br/>

# 프로젝트 개요
### 1. 프로젝트 주제 및 목표
- 주제: 김장철 주요 작물 질병 탐지
- 최근 김장철을 앞두고 배추, 고추 등 김장에 필요한 주요 작물들의 가격이 급등하며 문제로 떠오르고 있다. 특히 배추의 경우 폭염과 작물 질병이 겹쳐 생산량에 큰 영향을 미쳤다[1]. 이러한 상황에서, 질병에 신속히 대처할 수 있는 기술적 지원이 필요하다. 본 프로젝트는 AI-Hub의 "노지 작물 질병 진단 이미지" 데이터를 활용하여 주요 작물의 질병 분류 모델을 구축하는 것을 목표로 한다. CNN 기반 모델을 통해 작물 질병을 자동으로 판별하고, 빠른 대처가 가능하도록 지원함으로써 농가의 피해를 최소화하고자 한다.

<br/>

### 2. 데이터셋
- [AI-Hub의 노지 작물 질병 진단 이미지](https://www.aihub.or.kr/aihubdata/data/view.do?currMenu=115&topMenu=100&aihubDataSe=data&dataSetSn=147)
    - 여러가지 작물(고추, 무, 배추, 애호박, 양배추, 오이, 콩, 토마토, 파, 호박)의 질병 이미지 파일과 라벨링 파일로 이루어진 데이터셋
    - 주제에 맞게 전체 작물 중 고추, 무, 배추, 오이, 파, 총 5가지 작물의 질병 데이터셋 사용
        - **정상 클래스와 11개의 질병으로, 총 12개의 클래스**
    - 제공하는 형태 그대로 사용하지 않고 전처리를 통해 생성된 데이터셋 사용
        - 다운로드 링크
            - [CNN 데이터셋]()
            - [MTL 데이터셋]()

<br/>

### 3. 기대되는 결과 및 기여
- 본 프로젝트는 김장철 주요 작물의 질병 분류 모델을 개발하여, 농가가 질병을 조기에 탐지하고 신속히 대응할 수 있도록 지원하는 시스템을 구축하는 것을 목표로 한다. 이를 통해 농작물의 품질을 유지하고, 질병 확산을 예방함으로써 농가의 피해를 최소화할 수 있다. 또한, AI 기반의 자동화된 질병 진단 시스템을 제공함으로써, 기존의 육안 검사에 의존한 방법을 대체하고, 농업의 생산성을 향상시킬 수 있다. 이를 통해 농업 관리의 효율성을 높이고, 향후 다른 작물과 질병 또는 해충에 대한 추가적인 연구 및 시스템 적용의 기초 자료를 마련할 수 있다.

<br/><br/>

# 데이터셋 전처리

<br/><br/>

# CNN 모델 구축 및 학습
### CNN

<br/>

### ResNet

<br/><br/>

# MTL 모델 구축 및 학습
### 기본 모델

</br>

### 가중치 비율 적용

</br><br/>

# 모델 성능 비교
### 손실함수 적용 비율
| 손실함수 계산 비율(작물:질병) | 테스트 정확도(작물) | 테스트 정확도(질병) | 정밀도 (Precision) | 재현율 (Recall) |
| -------------------------- | ------------------- | ------------------- | ----------------- | --------------- |
| 0.3:0.7 (B모델)            | 95.97               | 91.58               | 0.95              | 0.89            |
| 0.5:0.5 (A모델)            | 98.53               | 94.02               | 0.93              | 0.89            |

</br>

### 가중치 비율 적용 여부
**1) 0.5:0.5 (작물:질병)**</br>

| 가중치 비율 적용 여부 | 테스트 정확도(작물) | 테스트 정확도(질병) | 정밀도 (Precision) | 재현율 (Recall) |
| ------------------- | ------------------- | ------------------- | ----------------- | --------------- |
| O                   | 98.53               | 92.55               | 0.91              | 0.90            |
| X (A모델)            | 98.53               | 94.02               | 0.93              | 0.89            |

</br>

**2) 0.3:0.7 (작물:질병)**</br>

| 가중치 비율 적용 여부 | 테스트 정확도(작물) | 테스트 정확도(질병) | 정밀도 (Precision) | 재현율 (Recall) |
| ------------------- | ------------------- | ------------------- | ----------------- | --------------- |
| O                   | 97.56               | 87.06               | 0.92              | 0.91            |
| X (B모델)            | 95.97               | 91.58               | 0.95              | 0.89            |

</br>

### 하이퍼파라미터 비교
- 손실함수 적용 비율은 동일한 비율(0.5)
- 가중치 비율 적용
    - A 모델만 가중치 적용X
    - 나머지는 가중치 적용O

| 배치 사이즈 | 에폭 | 테스트 정확도(작물) | 테스트 정확도(질병) | 정밀도 (Precision) | 재현율 (Recall) |
| ----------- | ---- | ------------------- | ------------------- | ----------------- | --------------- |
| 32 (A모델)  | 10   | 98.53               | **94.02**            | 0.93              | 0.89            |
| 32          | 20   | 98.90               | 93.53               | 0.62              | 0.63            |
| 64 (C모델)  | 10   | 99.15               | 92.92               | 0.91              | **0.92**        |
| 64          | 20   | 97.92               | 91.94               | 0.91              | 0.90            |

<br/>

## 최종 모델 비교
| 모델    | 배치 사이즈 | 에폭 | 가중치 비율 적용 | 손실함수 비율 | 테스트 정확도(질병) | 정밀도 (Precision) | 재현율 (Recall) |
| ------- | ----------- | ---- | ---------------- | ------------- | ------------------- | ----------------- | --------------- |
| CNN     | 32          | 10   | -                | -             | 41.15               | 0.11              | 0.11            |
| ResNet  | 32          | 10   | -                | -             | 83.88               | 0.11              | 0.11            |
| **A**   | **32**      |**10**| **O**            | **0.5:0.5**   | **94.02**           | **0.93**          | **0.89**        |
| B       | 32          | 10   | X                | 0.3:0.7       | 91.58               | 0.95              | 0.89            |
| **C**   | **64**      |**10**| **X**            | **0.5:0.5**   | **92.92**           | **0.91**          | **0.92**        |

- 질병 분류 모델이기 때문에 질병 정확도만 비교
- A 모델이 테스트 정확도가 가장 높으며 C 모델이 모델의 재현율이 제일 높음
  - 뿐만 아니라 전반적인 성능 또한 두 모델이 가장 우수함


<br/><br/>

# 프로젝트 주의사항 및 코드 사용 설명
### 프로젝트 환경
- Python 버전: 3.9.20
- CUDA 버전: 11.8
- 사용 도구: Visual Studio Code, Jupyter Notebook
- 사용 폰트(혼동행렬): 맑은고딕

</br>

### 주의사항
1. GPU 사용
    - 학습을 진행하기 위해서는 **반드시 GPU를 사용해야 합니다.**
        - 특히 MTL 모델 학습의 경우 GPU를 사용하지 않을 시 학습이 진행되지 않습니다.
        - check_cuda 폴더 내의 cuda 사용 여부 코드를 사용하여 GPU를 사용중인지 확인해주세요.
    - **과제를 진행하는 과정에서 주피터 노트북 파일에서는 GPU를 사용할 수 없어 파이썬 파일로 학습을 진행하였습니다.**
        - **과정 가시화를 위해 주피터 노트북 파일을 첨부하나 실제 학습 진행은 파이썬 파일로 진행하여 실행 결과가 저장되지 않았음을 유의해주세요.**
2. Tensorboard 사용
    - **학습 시 텐서보드 저장 위치를 항상 바꿔주세요.**
    - 기존의 경로를 사용할 경우, 이전 학습 정확도와 현재 학습 정확도가 섞여 문제가 생깁니다.

</br>

### 코드 사용 설명
- 

<br/><br/>

## Reference
- [MTL 모델 레퍼런스](https://gaussian37.github.io/dl-concept-mtl/#%EB%A9%80%ED%8B%B0-%ED%83%9C%EC%8A%A4%ED%81%AC-%EB%9F%AC%EB%8B%9D-%EA%B5%AC%ED%98%84-%EB%B0%8F-%EC%8B%A4%EC%8A%B5-1)
    - [모델 코드](https://colab.research.google.com/drive/1_hEKSoi9_UMZ5el-7PbjwwRedLYgS1w3?usp=sharing)
